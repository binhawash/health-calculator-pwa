<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>BodyTrack — مؤشرات مقارنة بالمثالي (ملف واحد)</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box}
    body{margin:0;font-family:'Tajawal',sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);color:#222}
    .container{min-height:100vh;background:#fff;padding:18px 16px}
    .header{background:linear-gradient(135deg,#007AFF,#0056b3);color:#fff;border-radius:14px;padding:18px;text-align:center;box-shadow:0 6px 20px rgba(0,0,0,.12)}
    .header h1{margin:0 0 6px;font-size:22px}
    .subtitle{opacity:.9;font-size:14px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:14px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:#fff;border:1px solid #e9ecef;border-radius:14px;padding:14px;box-shadow:0 2px 14px rgba(0,0,0,.06)}
    h3{margin:0 0 10px;font-size:16px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .row-3{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    .field{background:#f8f9fa;border:1px solid #e9ecef;border-radius:10px;padding:10px}
    .field label{display:block;font-size:13px;color:#555;margin-bottom:6px}
    .field input[type=number]{width:100%;border:none;background:transparent;font-size:16px;outline:none;text-align:center}
    .range-wrap{padding:8px 0}
    .range-val{font-weight:800;color:#007AFF;text-align:center;margin:6px 0}
    input[type=range]{width:100%;height:6px;border-radius:3px;background:#dee2e6;outline:none;-webkit-appearance:none}
    input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:#007AFF;box-shadow:0 2px 6px rgba(0,0,0,.2)}
    .radios{display:flex;gap:8px;flex-wrap:wrap}
    .radio{flex:1;min-width:90px;border:2px solid #dee2e6;border-radius:10px;text-align:center;padding:10px;cursor:pointer;transition:.15s;background:#fff}
    .radio input{display:none}
    .radio input:checked+span{background:#007AFF;color:#fff;padding:3px 10px;border-radius:8px}
    .btn{width:100%;padding:14px;border:none;border-radius:12px;background:linear-gradient(135deg,#007AFF,#0056b3);color:#fff;font-weight:800;cursor:pointer;box-shadow:0 6px 16px rgba(0,122,255,.25)}
    .btn.secondary{background:linear-gradient(135deg,#6c757d,#495057)}
    .btn.danger{background:linear-gradient(135deg,#FF5252,#D50000)}
    .small{font-size:12px;color:#6c757d}
    .stat{display:flex;align-items:center;justify-content:space-between;margin:6px 0}
    .stat .val{font-weight:800}
    .bar{position:relative;height:14px;background:#edf1f4;border-radius:999px;overflow:hidden}
    .fill{height:100%;width:0;background:linear-gradient(90deg,#29b6f6,#00c853)}
    .ticks{display:flex;justify-content:space-between;font-size:11px;color:#6c757d;margin-top:4px}
    .band{position:absolute;top:0;bottom:0;background:rgba(255,193,7,.25)}
    .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    .kpi-box{background:#f7f9fc;border:1px solid #e9ecef;border-radius:10px;padding:10px;text-align:center}
    .kpi-box .k{font-size:12px;color:#6c757d}
    .kpi-box .v{font-size:18px;font-weight:800;color:#007AFF}
    .list{max-height:220px;overflow:auto;border:1px dashed #e0e6eb;border-radius:10px;padding:8px;background:#fbfcfd}
    .item{display:flex;justify-content:space-between;border-bottom:1px solid #eef2f5;padding:8px 4px}
    .item:last-child{border-bottom:none}
    .sp{height:8px}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>BodyTrack — مؤشرات مقارنة بالمثالي</h1>
      <div class="subtitle">أدخل بياناتك وشاهد موقعك الحالي بالنسبة للمجالات المثالية</div>
    </div>

    <!-- إدخال البيانات -->
    <div class="grid">
      <div class="card">
        <h3>المدخلات الأساسية</h3>
        <div class="radios">
          <label class="radio"><input type="radio" name="gender" value="male" checked><span>ذكر</span></label>
          <label class="radio"><input type="radio" name="gender" value="female"><span>أنثى</span></label>
        </div>
        <div class="sp"></div>

        <div class="row">
          <div class="field">
            <label>الوزن (كغ)</label>
            <div class="range-val" id="w-val">70 كغ</div>
            <div class="range-wrap"><input id="w" type="range" min="30" max="200" value="70"></div>
          </div>
          <div class="field">
            <label>الطول (سم)</label>
            <div class="range-val" id="h-val">170 سم</div>
            <div class="range-wrap"><input id="h" type="range" min="120" max="220" value="170"></div>
          </div>
        </div>

        <div class="sp"></div>
        <div class="field">
          <label>النشاط اليومي</label>
          <div class="radios">
            <label class="radio"><input type="radio" name="act" value="sedentary" checked><span>قليل</span></label>
            <label class="radio"><input type="radio" name="act" value="light"><span>خفيف</span></label>
            <label class="radio"><input type="radio" name="act" value="moderate"><span>متوسط</span></label>
            <label class="radio"><input type="radio" name="act" value="active"><span>نشط</span></label>
            <label class="radio"><input type="radio" name="act" value="very_active"><span>نشط جدًا</span></label>
          </div>
        </div>

        <div class="sp"></div>
        <div class="row">
          <div class="field">
            <label>وقت الاستيقاظ</label>
            <div class="row">
              <input id="wh" type="number" min="0" max="23" value="6" class="field">
              <input id="wm" type="number" min="0" max="59" value="30" class="field">
            </div>
            <div class="small">صيغة 24 ساعة</div>
          </div>
          <div class="field">
            <label>وقت النوم</label>
            <div class="row">
              <input id="sh" type="number" min="0" max="23" value="22" class="field">
              <input id="sm" type="number" min="0" max="59" value="30" class="field">
            </div>
            <div class="small">صيغة 24 ساعة</div>
          </div>
        </div>
        <div class="sp"></div>
        <button class="btn" id="start">ابدأ التتبع</button>
      </div>

      <!-- مؤشرات -->
      <div class="card">
        <h3>مؤشرات سريعة (الحالي مقابل المثالي)</h3>
        <div class="kpi">
          <div class="kpi-box"><div class="k">BMI</div><div class="v" id="k-bmi">-</div></div>
          <div class="kpi-box"><div class="k">وزن مثالي (نطاق)</div><div class="v" id="k-ideal">-</div></div>
          <div class="kpi-box"><div class="k">ماء/اليوم</div><div class="v" id="k-water">-</div></div>
        </div>
        <div class="sp"></div>
        <div class="small">المثالي وفق: BMI 18.5–24.9، شرب الماء ~ 0.035 لتر/كغ مع معامل للنشاط.</div>
      </div>
    </div>

    <div class="grid" id="dash" style="display:none">
      <!-- مؤشر BMI -->
      <div class="card">
        <h3>مؤشر كتلة الجسم (BMI)</h3>
        <div class="stat"><span>القيمة الحالية</span><span class="val" id="bmi-val">-</span></div>
        <div class="stat"><span>التصنيف</span><span id="bmi-cat" class="small">-</span></div>
        <div class="bar" id="bmi-bar">
          <div class="band" id="bmi-band"></div>
          <div class="fill" id="bmi-fill"></div>
        </div>
        <div class="ticks"><span>0</span><span>10</span><span>20</span><span>30</span><span>40</span></div>
        <div class="small">الشريط الأصفر يوضح المجال المثالي (18.5–24.9)</div>
      </div>

      <!-- مؤشر الوزن مقابل المثالي -->
      <div class="card">
        <h3>الوزن الحالي مقابل الوزن المثالي</h3>
        <div class="stat"><span>النطاق المثالي</span><span class="val" id="ideal-range">-</span></div>
        <div class="stat"><span>المسافة لأقرب حد</span><span id="ideal-diff" class="small">-</span></div>
        <div class="bar" id="w-bar">
          <div class="fill" id="w-fill"></div>
        </div>
        <div class="ticks" id="w-ticks"></div>
        <div class="small">يُحسب النطاق المثالي حسب طولك (BMI من 18.5 إلى 24.9).</div>
      </div>

      <!-- ماء -->
      <div class="card">
        <h3>شرب الماء — التقدم اليومي</h3>
        <div class="stat"><span>المستهدف اليومي</span><span class="val" id="water-goal">-</span></div>
        <div class="bar"><div class="fill" id="water-fill"></div></div>
        <div class="ticks"><span>0%</span><span>25%</span><span>50%</span><span>75%</span><span>100%</span></div>
        <div class="row-3" style="margin-top:8px">
          <button class="btn" id="add-025">+0.25 لتر</button>
          <button class="btn" id="add-050">+0.5 لتر</button>
          <button class="btn danger" id="reset-water">تصفير</button>
        </div>
        <div class="stat"><span>مستهلك اليوم</span><span id="water-cons">0 لتر</span></div>
        <div class="small" id="water-pct">0%</div>
        <div class="list" id="water-list"></div>
      </div>

      <!-- بروتين -->
      <div class="card">
        <h3>البروتين — التقدم اليومي</h3>
        <div class="stat"><span>الاحتياج</span><span class="val" id="prot-need">-</span></div>
        <div class="bar"><div class="fill" id="prot-fill"></div></div>
        <div class="ticks"><span>0%</span><span>25%</span><span>50%</span><span>75%</span><span>100%</span></div>
        <div class="row-3" style="margin-top:8px">
          <button class="btn" id="add-p10">+10 جم</button>
          <button class="btn" id="add-p20">+20 جم</button>
          <button class="btn danger" id="reset-prot">تصفير</button>
        </div>
        <div class="stat"><span>مستهلك اليوم</span><span id="prot-cons">0 جم</span></div>
        <div class="small" id="prot-pct">0%</div>
      </div>

      <!-- سجل الوزن السريع -->
      <div class="card">
        <h3>سجل الوزن (آخر القيود)</h3>
        <div class="row" style="margin-bottom:8px">
          <input id="w-now" type="number" placeholder="وزنك الحالي" class="field">
          <button class="btn" id="add-w-rec">إضافة</button>
        </div>
        <div class="list" id="w-list"></div>
      </div>
    </div>
  </div>

  <script>
    // حسابات أساسية
    const F = {
      bmi(w,h){const m=h/100;return w/(m*m)},
      bmiCat(b){return b<18.5?'نحافة':b<25?'وزن صحي':b<30?'زيادة وزن':'سمنة'},
      idealRange(h){ const m=h/100; return [18.5*m*m, 24.9*m*m]; },
      waterGoal(w,act){const base=w*0.035;const f={sedentary:1,light:1.1,moderate:1.2,active:1.3,very_active:1.4}[act]||1;return +(base*f).toFixed(2)},
      proteinNeed(w,act){const f={sedentary:1,light:1.2,moderate:1.4,active:1.6,very_active:1.8}[act]||1.2;return Math.round(w*f)},
      awake(wh,wm,sh,sm){let h=sh-wh+(sm-wm)/60;if(h<=0)h+=24;return Math.round(h)}
    };

    // حالة
    const S = {g:'male',w:70,h:170,act:'sedentary',wh:6,wm:30,sh:22,sm:30,
               water:0, waterHist:[], prot:0, wHist:[]};

    const $=s=>document.querySelector(s);
    const $$=s=>document.querySelectorAll(s);
    const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

    function save(){try{localStorage.setItem('BT_ind',JSON.stringify(S))}catch(e){}}
    function load(){try{const x=localStorage.getItem('BT_ind'); if(x) Object.assign(S,JSON.parse(x))}catch(e){}}

    function initInputs(){
      $$('input[name=gender]').forEach(r=>{r.checked=r.value===S.g; r.onchange=()=>{S.g=r.value; recalc();}});
      $$('input[name=act]').forEach(r=>{r.checked=r.value===S.act; r.onchange=()=>{S.act=r.value; recalc();}});
      const w=$('#w'), h=$('#h');
      w.value=S.w; h.value=S.h;
      $('#w-val').textContent=S.w+' كغ';
      $('#h-val').textContent=S.h+' سم';
      w.oninput=e=>{S.w=+e.target.value; $('#w-val').textContent=S.w+' كغ'; recalc();};
      h.oninput=e=>{S.h=+e.target.value; $('#h-val').textContent=S.h+' سم'; recalc();};
      $('#wh').value=S.wh; $('#wm').value=S.wm; $('#sh').value=S.sh; $('#sm').value=S.sm;
      ['wh','wm','sh','sm'].forEach(id=>{$('#'+id).oninput=()=>{S[id]=+$('#'+id).value; recalc();};});
      $('#start').onclick=()=>{$('#dash').style.display='grid'; recalc(); save();};
    }

    function recalc(){
      const b=F.bmi(S.w,S.h);
      $('#k-bmi').textContent=b.toFixed(1);
      $('#bmi-val').textContent=b.toFixed(1);
      const cat=F.bmiCat(b);
      $('#bmi-cat').textContent=cat;

      const maxB=40;
      const pct=clamp((b/maxB)*100,0,100);
      $('#bmi-fill').style.width=pct+'%';
      const band=$('#bmi-band');
      const idealA=(18.5/maxB)*100, idealB=(24.9/maxB)*100;
      band.style.left=idealA+'%'; band.style.width=(idealB-idealA)+'%';

      const [wMin,wMax]=F.idealRange(S.h);
      $('#k-ideal').textContent = `${wMin.toFixed(1)}–${wMax.toFixed(1)} كغ`;
      $('#ideal-range').textContent = `${wMin.toFixed(1)} – ${wMax.toFixed(1)} كغ`;
      let diff=0, dir='داخل النطاق';
      if(S.w<wMin){diff=(wMin-S.w).toFixed(1); dir='دون الأدنى';}
      else if(S.w>wMax){diff=(S.w-wMax).toFixed(1); dir='فوق الأعلى';}
      $('#ideal-diff').textContent = (dir==='داخل النطاق') ? 'أنت داخل النطاق المثالي' : `${diff} كغ ${dir}`;
      const lo=wMin*0.9, hi=wMax*1.1, p2=clamp(((S.w-lo)/(hi-lo))*100,0,100);
      $('#w-fill').style.width=p2+'%';
      $('#w-ticks').innerHTML = `<span>${lo.toFixed(0)}</span><span>${((lo+hi)/2).toFixed(0)}</span><span>${hi.toFixed(0)}</span>`;

      const goal=F.waterGoal(S.w,S.act);
      $('#k-water').textContent=goal+' لتر';
      $('#water-goal').textContent=goal+' لتر';
      const wpct = clamp((S.water/goal)*100,0,100);
      $('#water-fill').style.width=wpct+'%';
      $('#water-cons').textContent=`${S.water.toFixed(2)} لتر`;
      $('#water-pct').textContent=Math.round(wpct)+'%';

      const pNeed=F.proteinNeed(S.w,S.act);
      $('#prot-need').textContent=pNeed+' جم/يوم';
      const ppct = clamp((S.prot/pNeed)*100,0,100);
      $('#prot-fill').style.width=ppct+'%';
      $('#prot-cons').textContent=S.prot+' جم';
      $('#prot-pct').textContent=Math.round(ppct)+'%';
      save();
    }

    function bindWaterProteinWeight(){
      $('#add-025').onclick=()=>{S.water+=0.25; S.waterHist.push({t:Date.now(),a:0.25}); renderWaterList(); recalc();};
      $('#add-050').onclick=()=>{S.water+=0.5; S.waterHist.push({t:Date.now(),a:0.5}); renderWaterList(); recalc();};
      $('#reset-water').onclick=()=>{S.water=0; recalc(); renderWaterList();};
      $('#add-p10').onclick=()=>{S.prot+=10; recalc();};
      $('#add-p20').onclick=()=>{S.prot+=20; recalc();};
      $('#reset-prot').onclick=()=>{S.prot=0; recalc();};
      $('#add-w-rec').onclick=()=>{
        const v=parseFloat($('#w-now').value);
        if(!v||v<=0){alert('أدخل وزنًا صحيحًا');return;}
        S.wHist.push({t:Date.now(),w:v}); S.w=v; $('#w').value=v; $('#w-val').textContent=v+' كغ';
        $('#w-now').value=''; renderWList(); recalc();
      };
    }

    function renderWaterList(){
      const box=$('#water-list');
      if(S.waterHist.length===0){ box.innerHTML='<div class="small" style="padding:8px">لا توجد قيود اليوم.</div>'; return; }
      const today=new Date(); today.setHours(0,0,0,0);
      const items = S.waterHist.filter(r=>{const d=new Date(r.t); d.setHours(0,0,0,0); return d.getTime()===today.getTime();})
        .sort((a,b)=>b.t-a.t).slice(0,30)
        .map(r=>{
          const d=new Date(r.t);
          const ti=d.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'});
          return `<div class="item"><span>${ti}</span><span>+${r.a.toFixed(2)} لتر</span></div>`;
        }).join('');
      box.innerHTML = items || '<div class="small" style="padding:8px">لا توجد قيود اليوم.</div>';
    }

    function renderWList(){
      const box=$('#w-list');
      if(S.wHist.length===0){ box.innerHTML='<div class="small" style="padding:8px">لا توجد قيود.</div>'; return; }
      const items=S.wHist.sort((a,b)=>b.t-a.t).slice(0,20).map(r=>{
        const d=new Date(r.t);
        const ds=d.toLocaleDateString('en-GB');
        const ts=d.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'});
        return `<div class="item"><span>${ds} ${ts}</span><span>${r.w} كغ</span></div>`;
      }).join('');
      box.innerHTML=items;
    }

    document.addEventListener('DOMContentLoaded',()=>{
      load();
      initInputs();
      bindWaterProteinWeight();
      if(S.wHist.length || S.water>0 || S.prot>0){ $('#dash').style.display='grid'; }
      renderWaterList(); renderWList();
      recalc();
    });
  </script>
</body>
</html>