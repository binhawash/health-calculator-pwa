<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#0ea5e9">
<title>حاسبة صحية | Health Calculator (PWA)</title>
<style>
  :root { --bg:#0b0c10; --card:#16181d; --text:#e6e6e6; --muted:#9aa0a6; --accent:#0ea5e9; --border:#272b33; }
  html, body { margin:0; padding:0; background:var(--bg); color:var(--text);
    font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",Roboto,"Noto Naskh Arabic UI","Noto Sans Arabic",Arial,sans-serif;}
  .wrap { max-width: 560px; margin: 0 auto; padding: 12px; }
  header { display:flex; align-items:center; justify-content:space-between; gap:8px; padding: 8px 0; position: sticky; top:0; background:var(--bg); z-index: 10; }
  .segmented { display:inline-flex; border:1px solid var(--border); border-radius:10px; overflow:hidden; }
  .segmented button { background:transparent; color:var(--text); border:0; padding:6px 10px; cursor:pointer; }
  .segmented button.active { background:var(--card); }
  .tabs { display:flex; gap:8px; }
  .tab { flex:1; text-align:center; padding:10px 8px; border-radius:10px; border:1px solid var(--border); cursor:pointer; }
  .tab.active { background:var(--accent); color:#fff; border-color:transparent; }
  .card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:14px; margin: 10px 0; }
  label { display:block; margin-top:8px; color:var(--muted); }
  input[type="number"], input[type="text"] { width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border); background:#0f1115; color:var(--text); }
  input[type="range"] { width:100%; }
  .row { display:flex; gap:8px; }
  .result-row { display:flex; justify-content:space-between; margin: 8px 0; }
  .value { font-weight: 700; }
  .hint { color: var(--muted); font-size: 0.9rem; }
  .footer { color: var(--muted); font-size: 0.85rem; }
  .logo { width:44px; height:44px; border-radius:10px; background:radial-gradient(circle at 30% 30%, #22c55e, #0ea5e9); display:flex; align-items:center; justify-content:center; font-weight:900; }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div style="display:flex; align-items:center; gap:10px;">
      <div class="logo">HC</div>
      <div>
        <div style="font-weight:700;" id="brand">حاسبة صحية</div>
        <div class="hint" id="team" style="font-size:12px;">Binhawash — Eng:M.A</div>
      </div>
    </div>
    <div class="segmented" id="langSeg">
      <button data-lang="ar" class="active">العربية</button>
      <button data-lang="en">English</button>
    </div>
  </header>

  <div class="tabs" id="tabs">
    <div class="tab active" data-tab="home">الترحيب</div>
    <div class="tab" data-tab="bmi">BMI</div>
    <div class="tab" data-tab="water">الماء</div>
    <div class="tab" data-tab="protein">البروتين</div>
    <div class="tab" data-tab="info">معلومات</div>
  </div>

  <!-- Home -->
  <section id="home" class="card">
    <h3 id="welcome_title">مرحبًا بك</h3>
    <p id="welcome_body">هذا إصدار PWA يعمل كتطبيق ويُضاف إلى الشاشة الرئيسية. من قائمة المشاركة في Safari اختر: <b>إضافة إلى الشاشة الرئيسية</b>.</p>
    <div class="hint" id="pwa_hint">بعد إضافته سيعمل في نافذة مستقلة ومن دون شريط المتصفح. يدعم العمل دون إنترنت بعد أول تشغيل.</div>
  </section>

  <!-- BMI -->
  <section id="bmi" class="card" style="display:none;">
    <div class="row">
      <div style="flex:1">
        <label id="lblWeightKg">الوزن كجم</label>
        <input id="bmiWeight" type="number" step="0.1" placeholder="70">
      </div>
      <div style="flex:1">
        <label id="lblHeightCm">الطول سم</label>
        <input id="bmiHeightCm" type="number" step="0.5" placeholder="170">
      </div>
    </div>
    <label id="lblWaist">محيط الخصر سم</label>
    <input id="bmiWaist" type="number" step="0.5" placeholder="85">
    <div class="result-row"><span id="lblBMI">مؤشر كتلة الجسم</span><span class="value" id="bmiValue">—</span></div>
    <div class="result-row"><span id="lblCat">الفئة</span><span class="value" id="bmiClass">—</span></div>
    <div class="result-row"><span>WHtR</span><span class="value" id="whtrValue">—</span></div>
    <div class="hint" id="bmiHint"></div>
    <div class="footer" id="bmiNote">المؤشر أداة تحرّي فقط وليس تشخيصًا.</div>
  </section>

  <!-- Water -->
  <section id="water" class="card" style="display:none;">
    <label id="lblWWeight">الوزن كجم</label>
    <input id="wWeight" type="number" step="0.1" placeholder="70">
    <label id="lblAct">دقائق النشاط يوميًا: <span id="actVal">0</span></label>
    <input id="act" type="range" min="0" max="180" step="10" value="0">
    <label id="lblMlKg">مل لكل كجم: <span id="mlkgVal">35</span></label>
    <input id="mlkg" type="range" min="25" max="45" step="1" value="35">
    <label id="lblCup">حجم الكوب (مل)</label>
    <input id="cup" type="number" value="250">
    <div class="result-row"><span id="lblMl">الاحتياج اليومي مل</span><span class="value" id="wMl">—</span></div>
    <div class="result-row"><span id="lblL">الاحتياج اليومي لتر</span><span class="value" id="wL">—</span></div>
    <div class="result-row"><span id="lblCups">عدد الأكواب يوميًا</span><span class="value" id="wCups">—</span></div>
  </section>

  <!-- Protein -->
  <section id="protein" class="card" style="display:none;">
    <label id="lblPWeight">الوزن كجم</label>
    <input id="pWeight" type="number" step="0.1" placeholder="70">
    <div class="segmented" id="goalSeg" style="margin-top:10px;">
      <button data-goal="maintenance" class="active">ثبات</button>
      <button data-goal="fatLoss">نقص دهون</button>
      <button data-goal="muscleGain">زيادة عضل</button>
    </div>
    <div class="result-row"><span id="lblRange">نطاق البروتين الموصى به</span><span class="value" id="pRange">—</span></div>
  </section>

  <!-- Info -->
  <section id="info" class="card" style="display:none;">
    <h3 id="aboutTitle">حول</h3>
    <p id="aboutBody">العلامة: حاسبة صحية / Health Calculator<br>الفريق: Binhawash — Eng:M.A</p>
    <p class="hint" id="disclaimer">تنبيه: النتائج تقديرية وليست نصيحة طبية.</p>
  </section>
</div>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./service-worker.js');
  });
}

let lang = 'ar';

function t(){
  const ar = {
    tabs: ['الترحيب','BMI','الماء','البروتين','معلومات'],
    welcome_title:'مرحبًا بك',
    welcome_body:'هذا إصدار PWA يعمل كتطبيق ويُضاف إلى الشاشة الرئيسية. من قائمة المشاركة في Safari اختر: "إضافة إلى الشاشة الرئيسية".',
    pwa_hint:'بعد إضافته سيعمل في نافذة مستقلة ومن دون شريط المتصفح. يدعم العمل دون إنترنت بعد أول تشغيل.',
    weightKg:'الوزن كجم', heightCm:'الطول سم', waistCm:'محيط الخصر سم',
    bmi:'مؤشر كتلة الجسم', category:'الفئة', note:'المؤشر أداة تحرّي فقط وليس تشخيصًا.',
    waterWeight:'الوزن كجم', act:'دقائق النشاط يوميًا', mlkg:'مل لكل كجم', cup:'حجم الكوب (مل)',
    waterMl:'الاحتياج اليومي مل', waterL:'الاحتياج اليومي لتر', cups:'عدد الأكواب يوميًا',
    proteinWeight:'الوزن كجم', range:'نطاق البروتين الموصى به',
    goal: {maintenance:'ثبات', fatLoss:'نقص دهون', muscleGain:'زيادة عضل'},
    about:'حول', aboutBody:'العلامة: حاسبة صحية / Health Calculator\nالفريق: Binhawash — Eng:M.A',
    disclaimer:'تنبيه: النتائج تقديرية وليست نصيحة طبية.',
    classes:{under:'نحافة', normal:'طبيعي', over:'زيادة وزن', obese:'سمنة'}
  };
  const en = {
    tabs: ['Welcome','BMI','Water','Protein','Info'],
    welcome_title:'Welcome',
    welcome_body:'This PWA works like an app. In Safari, use "Add to Home Screen".',
    pwa_hint:'After adding, it runs in standalone mode and works offline after first load.',
    weightKg:'Weight kg', heightCm:'Height cm', waistCm:'Waist cm',
    bmi:'Body Mass Index', category:'Category', note:'BMI is a screening tool, not a diagnosis.',
    waterWeight:'Weight kg', act:'Activity minutes/day', mlkg:'mL per kg', cup:'Cup size (mL)',
    waterMl:'Daily water mL', waterL:'Daily water L', cups:'Cups per day',
    proteinWeight:'Weight kg', range:'Recommended protein range',
    goal: {maintenance:'Maintain', fatLoss:'Fat loss', muscleGain:'Muscle gain'},
    about:'About', aboutBody:'Brand: Health Calculator / حاسبة صحية\nTeam: Binhawash — Eng:M.A',
    disclaimer:'Note: Estimates only; not medical advice.',
    classes:{under:'Underweight', normal:'Normal', over:'Overweight', obese:'Obese'}
  };
  return lang==='ar' ? ar : en;
}

function switchLang(l){
  lang = l;
  document.documentElement.lang = l;
  document.documentElement.dir = (l==='ar')?'rtl':'ltr';
  const tr = t();
  const tabs = document.querySelectorAll('#tabs .tab');
  [0,1,2,3,4].forEach(i => tabs[i].textContent = tr.tabs[i]);
  document.getElementById('welcome_title').textContent = tr.welcome_title;
  document.getElementById('welcome_body').textContent = tr.welcome_body;
  document.getElementById('pwa_hint').textContent = tr.pwa_hint;
  document.getElementById('lblWeightKg').textContent = tr.weightKg;
  document.getElementById('lblHeightCm').textContent = tr.heightCm;
  document.getElementById('lblWaist').textContent = tr.waistCm;
  document.getElementById('lblBMI').textContent = tr.bmi;
  document.getElementById('lblCat').textContent = tr.category;
  document.getElementById('bmiNote').textContent = tr.note;
  document.getElementById('lblWWeight').textContent = tr.waterWeight;
  document.getElementById('lblAct').childNodes[0].nodeValue = tr.act + ': ';
  document.getElementById('lblMlKg').childNodes[0].nodeValue = tr.mlkg + ': ';
  document.getElementById('lblCup').textContent = tr.cup;
  document.getElementById('lblMl').textContent = tr.waterMl;
  document.getElementById('lblL').textContent = tr.waterL;
  document.getElementById('lblCups').textContent = tr.cups;
  document.getElementById('lblPWeight').textContent = tr.proteinWeight;
  document.getElementById('lblRange').textContent = tr.range;
  document.querySelector('#goalSeg button[data-goal="maintenance"]').textContent = tr.goal.maintenance;
  document.querySelector('#goalSeg button[data-goal="fatLoss"]').textContent = tr.goal.fatLoss;
  document.querySelector('#goalSeg button[data-goal="muscleGain"]').textContent = tr.goal.muscleGain;
  document.getElementById('aboutTitle').textContent = tr.about;
  document.getElementById('aboutBody').innerHTML = tr.aboutBody.replaceAll("\n","<br>");
  document.getElementById('disclaimer').textContent = tr.disclaimer;
}

document.querySelectorAll('#langSeg button').forEach(b=> b.addEventListener('click', e=>{
  document.querySelectorAll('#langSeg button').forEach(x=> x.classList.remove('active'));
  b.classList.add('active');
  switchLang(b.dataset.lang);
}));

document.write('<div class="tabs" id="tabs"><div class="tab active" data-tab="home">الترحيب</div><div class="tab" data-tab="bmi">BMI</div><div class="tab" data-tab="water">الماء</div><div class="tab" data-tab="protein">البروتين</div><div class="tab" data-tab="info">معلومات</div></div>');

document.getElementById('tabs').addEventListener('click', (e)=>{
  if(!e.target.classList.contains('tab')) return;
  document.querySelectorAll('#tabs .tab').forEach(x=> x.classList.remove('active'));
  e.target.classList.add('active');
  const tab = e.target.dataset.tab;
  ['home','bmi','water','protein','info'].forEach(id => document.getElementById(id).style.display = 'none');
  document.getElementById(tab).style.display = 'block';
});

function fmt(n, dec=1){ return (!isFinite(n))? '—' : n.toLocaleString(lang==='ar'?'ar':'en', {maximumFractionDigits:dec, minimumFractionDigits:0}); }
function computeBMI(){
  const kg = parseFloat(document.getElementById('bmiWeight').value);
  const cm = parseFloat(document.getElementById('bmiHeightCm').value);
  const waist = parseFloat(document.getElementById('bmiWaist').value);
  if (!kg || !cm){ document.getElementById('bmiValue').textContent='—'; document.getElementById('bmiClass').textContent='—'; document.getElementById('whtrValue').textContent='—'; document.getElementById('bmiHint').textContent=''; return; }
  const h=cm/100, bmi=kg/(h*h); const c=t().classes;
  let klass = bmi<18.5? c.under : bmi<25? c.normal : bmi<30? c.over : c.obese;
  document.getElementById('bmiValue').textContent = fmt(bmi,1);
  document.getElementById('bmiClass').textContent = klass;
  if (waist){ const whtr = waist/cm; document.getElementById('whtrValue').textContent = fmt(whtr,2); }
  const minW=18.5*h*h, maxW=24.9*h*h;
  document.getElementById('bmiHint').innerHTML = (lang==='ar'?'النطاق الصحي: ':'Healthy range: ') + `<b>${fmt(minW,1)} – ${fmt(maxW,1)} kg</b>`;
}
function computeWater(){
  const kg = parseFloat(document.getElementById('wWeight').value);
  const act = parseFloat(document.getElementById('act').value);
  const mlkg = parseFloat(document.getElementById('mlkg').value);
  const cup = parseFloat(document.getElementById('cup').value)||250;
  document.getElementById('actVal').textContent = fmt(act,0);
  document.getElementById('mlkgVal').textContent = fmt(mlkg,0);
  if (!kg){ document.getElementById('wMl').textContent='—'; document.getElementById('wL').textContent='—'; document.getElementById('wCups').textContent='—'; return; }
  const total = kg*mlkg + (act/30)*500;
  document.getElementById('wMl').textContent = fmt(total,0);
  document.getElementById('wL').textContent = (total/1000).toLocaleString(lang==='ar'?'ar':'en', {maximumFractionDigits:2});
  document.getElementById('wCups').textContent = (total/cup).toLocaleString(lang==='ar'?'ar':'en', {maximumFractionDigits:1});
}
function computeProtein(){
  const kg = parseFloat(document.getElementById('pWeight').value);
  const goal = document.querySelector('#goalSeg .active').dataset.goal;
  let min=0, max=0;
  if (kg){
    if (goal==='maintenance'){ min=0.8*kg; max=1.0*kg; }
    if (goal==='fatLoss'){ min=1.2*kg; max=1.6*kg; }
    if (goal==='muscleGain'){ min=1.6*kg; max=2.2*kg; }
  }
  const unit = (lang==='ar')?'جرام/يوم':'g/day';
  document.getElementById('pRange').textContent = kg? `${fmt(min,0)} – ${fmt(max,0)} ${unit}` : '—';
}
['bmiWeight','bmiHeightCm','bmiWaist'].forEach(id => document.getElementById(id).addEventListener('input', computeBMI));
['wWeight','act','mlkg','cup'].forEach(id => document.getElementById(id).addEventListener('input', computeWater));
document.getElementById('pWeight').addEventListener('input', computeProtein);
document.querySelectorAll('#goalSeg button').forEach(b=> b.addEventListener('click', e=>{
  document.querySelectorAll('#goalSeg button').forEach(x=> x.classList.remove('active'));
  b.classList.add('active'); computeProtein();
}));
switchLang('ar'); computeBMI(); computeWater(); computeProtein();
</script>
</body>
</html>
